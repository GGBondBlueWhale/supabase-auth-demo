<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>GSearch Admin Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body class="app-body">
  <div class="bg-gradient"></div>
  <svg aria-hidden="true" focusable="false" class="defs" width="0" height="0" style="position:absolute">
    <defs>
      <linearGradient id="admin-grad" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" stop-color="#5ac8fa" />
        <stop offset="100%" stop-color="#7d89ff" />
      </linearGradient>
    </defs>
  </svg>

  <header class="top-bar glass">
    <div class="logo" data-i18n="brandAdmin">GSearch Admin</div>
    <div class="top-bar-right">
      <button id="lang-toggle" class="icon-btn" aria-label="Language" title="Language">
        <span class="lang-icon">中</span>
      </button>
      <button id="theme-toggle" class="icon-btn" aria-label="切换深浅色">
        <span class="theme-icon" aria-hidden="true"></span>
      </button>
      <span id="admin-email" class="user-email"></span>
      <button id="admin-logout-btn" class="ghost-btn" data-i18n="logout">退出</button>
    </div>
  </header>

  <main class="main-container smooth-shell">
    <section class="hero-banner flex-between">
      <div>
        <p class="capsule-label" data-i18n="heroTag">管理中心</p>
        <h1 data-i18n="heroTitle">生成与追踪 CDKey</h1>
        <p data-i18n="heroDesc">面向管理员的兑换码管理面板，快速生成、查看最近使用情况。</p>
      </div>
      <div class="status-chip" data-i18n="heroBadge">仅管理员可见</div>
    </section>

    <section class="card glass analytics-card">
      <div class="analytics-head flex-between">
        <div>
          <p class="capsule-label" data-i18n="analyticsTag">数据报表</p>
          <h2 data-i18n="analyticsTitle">用户 &amp; CDKey 概览</h2>
          <p class="sub-text" data-i18n="analyticsDesc">快速查看注册、订阅与兑换趋势。</p>
        </div>
      </div>
      <div class="kpi-grid">
        <div class="kpi-card">
          <p class="kpi-label" data-i18n="kpiUsers">总注册用户</p>
          <h3 id="kpi-users" class="kpi-value">—</h3>
          <span class="kpi-pill" data-i18n="kpiUsersSub">最近 30 天</span>
        </div>
        <div class="kpi-card">
          <p class="kpi-label" data-i18n="kpiActive">订阅中</p>
          <h3 id="kpi-active" class="kpi-value">—</h3>
          <span class="kpi-pill" data-i18n="kpiActiveSub">当前有效订阅</span>
        </div>
        <div class="kpi-card">
          <p class="kpi-label" data-i18n="kpiCdkeyTotal">CDKey 总数</p>
          <h3 id="kpi-cdkey-total" class="kpi-value">—</h3>
          <span class="kpi-pill" data-i18n="kpiCdkeyUsed">已使用 / 未使用</span>
          <p id="kpi-cdkey-split" class="sub-text">—</p>
        </div>
      </div>
      <div class="chart-row">
        <div class="mini-chart analytics-stage">
          <div class="chart-head flex-between">
            <div class="chart-toggle" role="tablist" aria-label="Analytics switcher">
              <button
                class="chart-pill active"
                data-chart-type="signup"
                role="tab"
                aria-selected="true"
              >
                <span class="tab-title" data-i18n="chartUsers">最近 7 天新注册</span>
              </button>
              <button class="chart-pill" data-chart-type="redeem" role="tab" aria-selected="false">
                <span class="tab-title" data-i18n="chartRedeem">最近 7 天兑换</span>
              </button>
            </div>
            <span class="tag">7d</span>
          </div>
          <div class="chart-stage" aria-live="polite">
            <canvas id="chart-analytics" class="chart-canvas"></canvas>
          </div>
        </div>
      </div>
    </section>

    <section class="dashboard-grid">
      <div class="card glass action-card">
        <div class="flex-between">
          <div>
            <p class="capsule-label" data-i18n="createTag">批量生成</p>
            <h2 data-i18n="createTitle">生成 CDKey</h2>
            <p class="sub-text" data-i18n="createDesc">设定套餐、天数与数量，一键生成并复制保存。</p>
          </div>
        </div>
        <form id="create-cdkey-form" class="form-inline">
          <input id="plan-input" type="text" placeholder="套餐名，如 pro" value="pro" data-i18n-placeholder="planPlaceholder" />
          <input id="days-input" type="number" placeholder="天数，如 30" value="30" data-i18n-placeholder="daysPlaceholder" />
          <input id="count-input" type="number" placeholder="数量，如 5" value="1" data-i18n-placeholder="countPlaceholder" />
          <button type="submit" class="primary-btn" data-i18n="createSubmit">生成</button>
        </form>
        <p class="hint" data-i18n="createHint">生成的兑换码仅管理员可见，用户只能拿到你发给他的码。</p>
        <pre id="created-codes" class="codes-output"></pre>
      </div>

      <div class="card glass user-panel">
        <div class="split-head">
          <div>
            <p class="capsule-label" data-i18n="userPanelTag">用户详情</p>
            <h3 data-i18n="userPanelTitle">用户概览与代填兑换</h3>
            <p class="sub-text" data-i18n="userPanelDesc">快速搜索用户、查看订阅并代为兑换 CDKey。</p>
          </div>
        </div>
        <div class="user-grid">
          <div class="user-list">
            <div class="table-toolbar">
              <input id="user-search" type="text" placeholder="搜索邮箱" class="search-input" />
              <div class="pagination-controls">
                <button id="user-prev" class="ghost-btn nav-btn" type="button">上一页</button>
                <span id="user-page-info" class="page-info">第 1 / 1 页</span>
                <button id="user-next" class="ghost-btn nav-btn" type="button">下一页</button>
              </div>
            </div>
            <table class="cdkey-table compact" id="user-table">
              <thead>
                <tr>
                  <th>Email</th>
                  <th>订阅状态</th>
                  <th>到期</th>
                  <th>管理员</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="user-detail glass">
            <h4 data-i18n="userDetailTitle">详情</h4>
            <div id="user-detail-body" class="detail-body">选择左侧用户查看信息。</div>
            <form id="admin-redeem-form" class="form-inline slim">
              <input id="admin-redeem-code" type="text" placeholder="CDKey" />
              <button type="submit" class="secondary-btn" data-i18n="redeemForUser">代该用户兑换</button>
            </form>
            <p id="admin-redeem-status" class="status-text"></p>
          </div>
        </div>
      </div>
    </section>

    <section class="card glass cdkey-segment">
      <div class="flex-between section-head">
        <div>
          <p class="capsule-label" data-i18n="listTag">记录</p>
          <h2 data-i18n="listTitle">最近生成 / 使用的 CDKey</h2>
          <p class="sub-text" data-i18n="listDesc">自动按照「未使用」与「已使用」分区，切换查看更清晰。</p>
        </div>
      </div>

      <div class="segment-tabs" role="tablist">
        <button
          class="segment-tab active"
          data-status="unused"
          role="tab"
          aria-selected="true"
        >
          <span class="tab-title" data-i18n="tabUnused">未使用</span>
          <span class="tab-sub" data-i18n="tabUnusedDesc">等待发放</span>
        </button>
        <button class="segment-tab" data-status="used" role="tab" aria-selected="false">
          <span class="tab-title" data-i18n="tabUsed">已使用</span>
          <span class="tab-sub" data-i18n="tabUsedDesc">兑换记录</span>
        </button>
      </div>

      <div class="segment-panel active" role="tabpanel">
        <div class="sub-card glass">
          <div class="split-head">
            <div>
              <p id="status-badge" class="capsule-label success">未使用</p>
              <h3 id="list-title">等待分发的兑换码</h3>
              <p id="list-desc" class="sub-text">
                支持分页查看，默认每页 50 条，可随时切换已使用/未使用列表。
              </p>
            </div>
            <span id="list-tag" class="tag">最新</span>
          </div>

          <div class="table-toolbar">
            <div class="table-meta">
              <span class="pill success" data-i18n-scope="unused">未使用：<strong id="unused-count">0</strong></span>
              <span class="pill muted" data-i18n-scope="used">已使用：<strong id="used-count">0</strong></span>
            </div>
            <div class="bulk-actions">
              <button id="bulk-delete" class="ghost-btn" type="button" disabled>删除选中</button>
              <button id="bulk-assign" class="secondary-btn" type="button" disabled>批量分配</button>
            </div>
            <div class="pagination-controls">
              <button id="prev-page-btn" class="ghost-btn nav-btn" type="button" data-i18n="prevPage">上一页</button>
              <span id="page-info" class="page-info">第 1 / 1 页（共 0 条）</span>
              <button id="next-page-btn" class="ghost-btn nav-btn" type="button" data-i18n="nextPage">下一页</button>
            </div>
          </div>

          <table id="cdkey-table" class="cdkey-table">
            <thead>
              <tr>
                <th><input type="checkbox" id="select-all" aria-label="select all" /></th>
                <th data-i18n="thCode">Code</th>
                <th data-i18n="thPlan">Plan</th>
                <th data-i18n="thDays">Days</th>
                <th data-i18n="thStatus">Status</th>
                <th data-i18n="thUsedBy">Used By</th>
                <th data-i18n="thUsedAt">Used At</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <div class="modal" id="assign-modal" aria-hidden="true" role="dialog" aria-modal="true" aria-label="Assign CDKeys">
      <div class="modal-content glass">
        <div class="split-head">
          <h3 data-i18n="assignTitle">分配给用户</h3>
          <button type="button" class="icon-btn" id="close-assign" aria-label="close">✕</button>
        </div>
        <p class="sub-text" data-i18n="assignDesc">输入用户邮箱或选择用户，确认后将选中 CDKey 分配给对方。</p>
        <form id="assign-form" class="form-inline slim">
          <input type="email" id="assign-email" placeholder="user@example.com" />
          <button type="submit" class="primary-btn" data-i18n="assignSubmit">确认分配</button>
        </form>
        <p id="assign-selected-count" class="status-text" data-i18n="assignSelected" data-count="0">已选择 0 个 CDKey</p>
        <div class="assign-picker">
          <div class="split-head">
            <h4 data-i18n="assignUserPicker">选择用户</h4>
            <span class="sub-text" data-i18n="assignUserHint">输入邮箱或点击下方用户填充</span>
          </div>
          <div id="assign-user-list" class="assign-user-list"></div>
        </div>
        <p id="assign-status" class="status-text"></p>
      </div>
    </div>

    <div
      class="modal"
      id="delete-confirm-modal"
      aria-hidden="true"
      role="dialog"
      aria-modal="true"
      aria-labelledby="delete-confirm-title"
      aria-describedby="delete-confirm-desc"
    >
      <div class="modal-content glass">
        <div class="split-head">
          <h3 id="delete-confirm-title" data-i18n="deleteConfirmTitle">确认删除选中 CDKey？</h3>
          <button type="button" class="icon-btn" id="close-delete-confirm" aria-label="close">✕</button>
        </div>
        <p id="delete-confirm-desc" class="sub-text" data-i18n="deleteConfirmDesc">你将删除 0 个未使用的 CDKey，此操作不可恢复。</p>
        <div class="modal-actions">
          <button type="button" class="ghost-btn" id="cancel-delete" data-i18n="cancel">取消</button>
          <button type="button" class="danger-btn" id="confirm-delete" data-i18n="deleteConfirm">确认删除</button>
        </div>
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script type="module" src="admin.js"></script>
</body>
</html>
